# API Overview

Comprehensive guide to the Affelios API for developers building integrations and custom solutions.

## Introduction

### API Purpose
The Affelios API provides programmatic access to platform functionality, enabling developers to:
- Integrate affiliate tracking into existing systems
- Build custom applications and dashboards
- Automate affiliate program management
- Create advanced reporting and analytics solutions

### API Philosophy
1. **RESTful Design**
   - Resource-based URL structure
   - Standard HTTP methods
   - Consistent response formats
   - Stateless interactions

2. **Developer-Friendly**
   - Clear documentation and examples
   - Comprehensive error handling
   - Consistent naming conventions
   - Extensive testing capabilities

## Getting Started

### API Access
1. **Account Requirements**
   - Active Affelios account required
   - API access enabled for account
   - Appropriate user permissions
   - Terms of service acceptance

2. **Authentication Setup**
   - API key generation
   - Authentication method selection
   - Security configuration
   - Access scope definition

### Quick Start Guide
1. **Initial Setup**
   ```bash
   # Generate API credentials
   curl -X POST https://api.affelios.com/v1/auth/api-keys \
     -H "Authorization: Bearer YOUR_TOKEN" \
     -H "Content-Type: application/json" \
     -d '{"name": "My Integration", "scopes": ["read", "write"]}'
   ```

2. **First API Call**
   ```bash
   # Get account information
   curl -X GET https://api.affelios.com/v1/account \
     -H "Authorization: Bearer YOUR_API_KEY" \
     -H "Content-Type: application/json"
   ```

## API Structure

### Base URL
```
https://api.affelios.com/v1
```

### Version Management
1. **Current Version**
   - API version 1.0 (v1)
   - Backward compatibility maintenance
   - Deprecation notice procedures
   - Migration support provision

2. **Version Headers**
   ```http
   Accept: application/vnd.affelios.v1+json
   Content-Type: application/json
   ```

### Resource Organization
1. **Core Resources**
   - `/account` - Account management
   - `/programs` - Affiliate programs
   - `/affiliates` - Affiliate management
   - `/campaigns` - Campaign management
   - `/tracking` - Tracking and attribution
   - `/reports` - Analytics and reporting
   - `/payments` - Payment management

2. **Resource Relationships**
   - Hierarchical resource structure
   - Related resource linking
   - Nested resource access
   - Cross-reference capabilities

## Authentication

### API Key Authentication
1. **Key Generation**
   - Secure key generation process
   - Multiple key support
   - Scope-based permissions
   - Expiration management

2. **Key Usage**
   ```http
   Authorization: Bearer YOUR_API_KEY
   ```

### OAuth 2.0 (Coming Soon)
1. **OAuth Flow**
   - Authorization code grant
   - Client credentials grant
   - Refresh token support
   - Scope-based access

2. **Security Features**
   - PKCE support
   - State parameter validation
   - Secure redirect handling
   - Token lifecycle management

## Request Format

### HTTP Methods
1. **GET Requests**
   - Resource retrieval
   - List operations
   - Search and filtering
   - Data export

2. **POST Requests**
   - Resource creation
   - Data submission
   - Bulk operations
   - Action triggers

3. **PUT/PATCH Requests**
   - Resource updates
   - Partial modifications
   - Bulk updates
   - Configuration changes

4. **DELETE Requests**
   - Resource deletion
   - Bulk deletion
   - Soft deletion support
   - Cascade operations

### Request Headers
```http
Content-Type: application/json
Authorization: Bearer YOUR_API_KEY
User-Agent: YourApp/1.0
X-Request-ID: unique-request-identifier
```

### Request Body
```json
{
  "data": {
    "type": "resource_type",
    "attributes": {
      "field1": "value1",
      "field2": "value2"
    },
    "relationships": {
      "related_resource": {
        "data": {"type": "related_type", "id": "123"}
      }
    }
  }
}
```

## Response Format

### Success Responses
1. **Single Resource**
   ```json
   {
     "data": {
       "id": "123",
       "type": "affiliate",
       "attributes": {
         "name": "John Doe",
         "email": "john@example.com",
         "status": "active"
       },
       "relationships": {
         "programs": {
           "links": {
             "related": "/affiliates/123/programs"
           }
         }
       }
     },
     "meta": {
       "timestamp": "2023-01-01T00:00:00Z",
       "version": "1.0"
     }
   }
   ```

2. **Resource Collections**
   ```json
   {
     "data": [
       {
         "id": "123",
         "type": "affiliate",
         "attributes": {...}
       }
     ],
     "meta": {
       "total": 150,
       "page": 1,
       "per_page": 25,
       "total_pages": 6
     },
     "links": {
       "first": "/affiliates?page=1",
       "last": "/affiliates?page=6",
       "next": "/affiliates?page=2"
     }
   }
   ```

### Error Responses
```json
{
  "errors": [
    {
      "id": "error-123",
      "status": "400",
      "code": "VALIDATION_ERROR",
      "title": "Validation Error",
      "detail": "The email field is required",
      "source": {
        "pointer": "/data/attributes/email"
      }
    }
  ],
  "meta": {
    "timestamp": "2023-01-01T00:00:00Z",
    "request_id": "req-123"
  }
}
```

## Pagination

### Pagination Parameters
```http
GET /affiliates?page=2&per_page=50&sort=created_at&order=desc
```

### Response Metadata
```json
{
  "meta": {
    "current_page": 2,
    "per_page": 50,
    "total": 500,
    "total_pages": 10,
    "has_next": true,
    "has_prev": true
  },
  "links": {
    "first": "/affiliates?page=1&per_page=50",
    "last": "/affiliates?page=10&per_page=50",
    "next": "/affiliates?page=3&per_page=50",
    "prev": "/affiliates?page=1&per_page=50"
  }
}
```

## Filtering and Sorting

### Query Parameters
1. **Filtering**
   ```http
   GET /affiliates?filter[status]=active&filter[created_at][gte]=2023-01-01
   ```

2. **Sorting**
   ```http
   GET /affiliates?sort=name,-created_at
   ```

3. **Field Selection**
   ```http
   GET /affiliates?fields[affiliates]=name,email,status
   ```

### Advanced Filtering
```http
GET /reports/conversions?filter[date][between]=2023-01-01,2023-01-31&filter[affiliate_id][in]=123,456,789
```

## Rate Limiting

### Rate Limit Rules
1. **Default Limits**
   - 1000 requests per hour per API key
   - 100 requests per minute per IP
   - Burst allowance of 50 requests
   - Rate limit reset timing

2. **Rate Limit Headers**
   ```http
   X-RateLimit-Limit: 1000
   X-RateLimit-Remaining: 999
   X-RateLimit-Reset: 1640995200
   X-RateLimit-Retry-After: 3600
   ```

### Rate Limit Handling
```javascript
if (response.status === 429) {
  const retryAfter = response.headers['X-RateLimit-Retry-After'];
  // Wait and retry
  setTimeout(() => retryRequest(), retryAfter * 1000);
}
```

## Error Handling

### HTTP Status Codes
- `200` - Success
- `201` - Created
- `204` - No Content
- `400` - Bad Request
- `401` - Unauthorized
- `403` - Forbidden
- `404` - Not Found
- `422` - Unprocessable Entity
- `429` - Too Many Requests
- `500` - Internal Server Error

### Error Code System
```json
{
  "errors": [
    {
      "code": "AFFILIATE_NOT_FOUND",
      "status": "404",
      "title": "Affiliate Not Found",
      "detail": "The affiliate with ID 123 was not found"
    }
  ]
}
```

## SDKs and Tools

### Official SDKs
1. **JavaScript/Node.js**
   ```bash
   npm install @affelios/api-client
   ```

2. **Python**
   ```bash
   pip install affelios-api
   ```

3. **PHP**
   ```bash
   composer require affelios/api-client
   ```

### Development Tools
1. **API Explorer**
   - Interactive API documentation
   - Request/response testing
   - Authentication testing
   - Code generation

2. **Postman Collection**
   - Pre-configured requests
   - Environment variables
   - Test scripts
   - Documentation

## Best Practices

### Performance Optimization
1. **Request Optimization**
   - Batch requests when possible
   - Use field selection to minimize data
   - Implement proper caching strategies
   - Monitor rate limits

2. **Error Handling**
   - Implement retry logic with exponential backoff
   - Handle rate limiting gracefully
   - Log errors for debugging
   - Provide meaningful user feedback

### Security Considerations
1. **API Key Security**
   - Store keys securely
   - Rotate keys regularly
   - Use environment variables
   - Implement key scope restrictions

2. **Data Protection**
   - Validate all inputs
   - Sanitize user data
   - Implement HTTPS only
   - Follow data privacy regulations

## Support and Resources

### Documentation
- Complete API reference
- Code examples and tutorials
- Integration guides
- Best practice recommendations

### Support Channels
- Developer support forum
- Email support for technical issues
- Live chat during business hours
- Community resources and examples
